

namespace = ftr_ic_event

# Use single-heir succession but have two good heirs
ftr_ic_event.0002 = {
	type = character_event
	title = ftr_ic_event.0002.t
	desc = ftr_ic_event.0002.desc
	theme = diplomacy
	left_portrait = {
		character = scope:first_suc
		animation = worry
	}
	right_portrait = {
		character = scope:second_suc
		animation = scheme
	}

	trigger = {
		OR = {
			has_realm_law = single_heir_succession_law
			has_realm_law = single_heir_succession_law_youngest
		}
		any_child = {
			count >= 2
			is_adult = yes
			root.primary_title = {
				place_in_line_of_succession = {
					target = prev
					value <= 3
				}
			}
		}
		NOT = { has_character_flag = ftr_had_ss_story }
	}

	immediate = {
		save_scope_as = liege_c
		random_child = {
			limit = {
				scope:liege_c.primary_title = {
					place_in_line_of_succession = {
						target = prev
						value = 1
					}
				}
			}
			save_scope_as = first_suc
		}
		random_child = {
			limit = {
				scope:liege_c.primary_title = {
					place_in_line_of_succession = {
						target = prev
						value = 2
					}
				}
			}
			save_scope_as = second_suc
		}
	}

	option = { # Strengthen succession right of my primary successor
		name = ftr_ic_event.0002.a
		scope:first_suc = {
			add_opinion = {
				modifier = grateful_opinion
				target = scope:liege_c
				opinion = 20
			}
			add_prestige = 200
		}
		scope:second_suc = {
			add_opinion = {
				modifier = disappointed_opinion
				target = scope:liege_c
				opinion = -30
			}
			add_prestige = -120
			progress_towards_rival_effect = {
				REASON = rival_from_stance
				CHARACTER = scope:first_suc
				OPINION = -40
			}
			trigger_event = ftr_ic_event.0201
		}
		ai_chance = {
			base = 50
			modifier = {
				add = 20
				has_trait = just
			}
			opinion_modifier = {
				opinion_target = scope:first_suc
				multiplier = 0.5
			}
		}
	}

	option = { # Strengthen succession right of my secondary successor
		name = ftr_ic_event.0002.b
		trigger = {
			prestige >= 1000
		}
		add_prestige = -1000
		send_interface_toast = {
			type = event_toast_effect_neutral
			title = designate_heir_interaction_notification
			left_icon = root
			right_icon = scope:second_suc
			set_designated_heir = scope:second_suc
		}
		scope:second_suc = {
			add_opinion = {
				modifier = grateful_opinion
				target = scope:liege_c
				opinion = 40
			}
			add_prestige = 200
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_neutral
					title = designate_heir_interaction_notification
					left_icon = root
					right_icon = scope:second_suc
					show_as_tooltip = {
						set_designated_heir = scope:second_suc
					}
				}
			}
		}
		scope:first_suc = {
			add_opinion = {
				modifier = disappointed_opinion
				target = scope:liege_c
				opinion = -60
			}
			add_prestige = -120
			progress_towards_rival_effect = {
				REASON = rival_from_stance
				CHARACTER = scope:liege_c
				OPINION = -40
			}
			hidden_effect = {
				send_interface_toast = {
					type = event_toast_effect_neutral
					title = designate_heir_interaction_notification
					left_icon = root
					right_icon = scope:second_suc
					show_as_tooltip = {
						set_designated_heir = scope:second_suc
					}
				}
			}
			trigger_event = ftr_ic_event.0201
		}
		ai_chance = {
			base = 20
			opinion_modifier = {
				opinion_target = scope:second_suc
				multiplier = 0.5
			}
		}
	}

	option = { # Maintain status quo but encourage my secondary successor
		name = ftr_ic_event.0002.c
		scope:first_suc = {
			stress_impact = { base = medium_stress_impact_gain }
		}
		scope:second_suc = {
			add_opinion = {
				modifier = grateful_opinion
				target = scope:liege_c
				opinion = 20
			}
			add_prestige = 120
		}
		hidden_effect = {
			set_variable = {
				name = first_heir
				value = scope:first_suc
				days = 3
			}
			set_variable = {
				name = second_heir
				value = scope:second_suc
				days = 3
			}
			create_story = ftr_story_cycle_succession_struggle
		}
		ai_chance = {
			base = 50
		}
	}

	after = {}
}

# Liege change heir notify
ftr_ic_event.0201 = {
	type = character_event
	title = ftr_ic_event.0201.t
	desc = ftr_ic_event.0201.desc
	theme = diplomacy
	left_portrait = {
		character = scope:first_suc
		animation = worry
	}
	right_portrait = {
		character = scope:second_suc
		animation = scheme
	}

	option = { # Accept
		name = ftr_ic_event.0201.a
		ai_chance = {
			base = 20
			modifier = {
				add = 20
				has_trait = just
			}
		}
	}

	option = { # Coup
		name = ftr_ic_event.0201.b
		begin_scheme_with_agents_effect = {
			SCHEME_TYPE = coup
			TARGET_TYPE = target_character
			TARGET_SCOPE = scope:liege_c
			# Success.
			AGENT_1 = agent_thug
			AGENT_2 = agent_ambusher
			AGENT_3 = agent_muscle
			# Speed.
			AGENT_4 = agent_footpad
			# Secrecy.
			AGENT_5 = agent_lookout
		}
		ai_chance = {
			base = 20
			modifier = {
				add = 20
				age >= 30
			}
			modifier = {
				add = 100
				has_trait = ambitious
			}
		}
	}
}

# Liege receive end story notify
ftr_ic_event.0202 = {
	type = character_event
	title = ftr_ic_event.0202.t
	desc = ftr_ic_event.0202.desc
	theme = diplomacy
	left_portrait = {
		character = scope:first_suc
		animation = worry
	}
	right_portrait = {
		character = scope:second_suc
		animation = scheme
	}

	option = { # Accept
		name = ftr_ic_event.0202.a
		show_as_tooltip = {
			scope:story = {
				end_story = yes
			}
		}
	}
}
